{% extends "base.html" %}
{% block title %}Detalle del Vuelo{% endblock %}
{% block content %}

{% if user.is_authenticated %}

    <div class="card shadow my-4"> 
        <div class="card-body d-flex flex-wrap align-items-center justify-content-evenly gap-3"> 
            <div class="d-flex align-items-center flex-wrap gap-3">
                <h2>Información del Vuelo</h2>
            </div>
        </div>
        <div class="card-body d-flex flex-wrap align-items-center justify-content-evenly gap-3">
            <p class="">{{ vuelo.origen.nombre }} <i class="bi bi-arrow-right"></i> {{ vuelo.destino.nombre }}</p>
        </div>
        <div class="card-footer d-flex justify-content-around align-items-center">
            <div>
                <div class="info-label">Salida</div>
                <span class="info-value">{{ vuelo.fecha_salida|date:"d/m/Y H:i" }}</span>
            </div>
            <div>
                <div class="info-label">Llegada</div>
                <span class="info-value">{{ vuelo.fecha_llegada|date:"d/m/Y H:i" }}</span>            
            </div>
            <div>
                <div class="info-label">Avión</div>
                <span class="info-value">{{ vuelo.avion.modelo }}</span>
            </div>
            <div>
                <div class="info-label">Precio</div>
                <span class="info-value">${{ vuelo.precio_base }}</span>
            </div>
        </div>
    </div>

    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-number">{{ total_asientos }}</div>
            <div class="stat-label">Totales</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ asientos_libres }}</div>
            <div class="stat-label">Disponibles</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ asientos_ocupados|length }}</div>
            <div class="stat-label">Ocupados</div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item legend-available">
            <span class="legend-color"></span> <span>Disponible</span>
        </div>
        <div class="legend-item legend-occupied">
            <span class="legend-color"></span> <span>Ocupado</span>
        </div>
        <div>
            P = Primera Clase
        </div>
        <div>
            E = Económica
        </div>
    </div>

    <div class="seats-grid">
        {% for asiento in asientos_disponibles %}
            <a href="{% url 'reserva_create' vuelo_id=vuelo.id asiento_id=asiento.id %}"
                class="seat available"
                title="Asiento {{ asiento.numero }} - {{ asiento.tipo }}">
                {{ asiento.numero }}<br>{{ asiento.tipo }}
            </a>
        {% endfor %}

        {% for asiento in asientos_ocupados %}
            <div class="seat occupied"
                    title="Asiento {{ asiento.numero }} - {{ asiento.tipo }}">
                {{ asiento.numero }}<br>{{ asiento.tipo }}
            </div>
        {% endfor %}
    </div>

    <!-- Enlaces -->
    <div class="card mt-4 border-0 shadow">
        <div class="card-body d-flex flex-wrap gap-3 justify-content-start">
            <a href="{% url 'vuelo_list' %}" class="btn btn-outline-primary btn-md rounded-pill"><i class="bi bi-arrow-left"></i> Volver a Vuelos</a>
        </div>
    </div>

{% else %}
    <div class="container py-5">
        <div class="text-center">
            <p class="display-4">🚫</p>
            <h2>Acceso Denegado</h2>
            <p>Por favor, inicia sesión para ver los detalles del vuelo.</p>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">
                Iniciar sesión
            </button>
        </div>
    </div>
{% endif %}

<!-- Modales -->
{% include 'account/login_modal.html' %}
{% include 'account/register_modal.html' %}

{% endblock %}
